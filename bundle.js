(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(void 0,i=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o.key),"symbol"===e(i)?i:String(i)),o)}var i}function n(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return o(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,e)},r(e)}function o(e,t,n){return o=i()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&c(o,n.prototype),o},o.apply(null,arguments)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(f,e);var r,o,l,u,s=(r=f,o=i(),function(){var e,t=a(r);if(o){var i=a(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return n(this,e)});function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=s.call(this)).addEventListener("dblclick",e._renameElement),e.addEventListener("click",e._highlightElement),e}return l=f,(u=[{key:"_renameElement",value:function(){var e=this.innerHTML,t=document.createElement("input");t.value=e,t.onblur=function(){var e=this.value;this.parentNode.innerHTML=e},t.onkeyup=function(e){if("Enter"==e.key){var t=this.value;this.parentNode.innerHTML=t}},this.innerHTML="",this.appendChild(t),t.focus()}}])&&t(l.prototype,u),Object.defineProperty(l,"prototype",{writable:!1}),f}(r(HTMLElement));function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function f(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}customElements.define("folder-element",l);var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(i,e);var t,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(n);if(r){var o=d(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return f(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this)}return t=i,Object.defineProperty(t,"prototype",{writable:!1}),t}(l);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function m(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}customElements.define("file-element",p);var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(i,e);var t,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(n);if(r){var o=h(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return m(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this)}return t=i,Object.defineProperty(t,"prototype",{writable:!1}),t}(l);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===w(o)?o:String(o)),r)}var o}customElements.define("object-element",v);var _=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._array=t,this._node=document.querySelector(".content"),this._generateId=n}var t,n;return t=e,(n=[{key:"renderTree",value:function(){this._createTree(this._array,this._node)}},{key:"_createTree",value:function(e,t){var n=this;e.forEach((function(e){var r=n._createElement(e);t.classList.contains("content")?t.appendChild(r):t.childNodes.length>0&&t.querySelector(".wrapper").appendChild(r),e.children.length>0&&n._createTree(e.children,r)}))}},{key:"_createElement",value:function(e){var t,n=e.label,r=(e.icon,e.type),o=e.children,i=document.createElement("li");i.classList.add("list-item"),"file"===r?t="file-element":"folder"===r?t="folder-element":"object"===r&&(t="object-element");var c=document.createElement(t);c.textContent=n,c.id=this._generateId(),c.classList.add("item"),c.tabIndex=0,"file-element"===t?c.classList.add("item-file"):"folder"===r?c.classList.add("item-folder"):"object"===r&&c.classList.add("item-object"),i.appendChild(c);var a=document.createElement("span");a.classList.add("caret"),a.addEventListener("click",(function(){this.parentElement.querySelector(".wrapper").classList.toggle("active"),this.classList.toggle("caret-down")}));var l=document.createElement("ul");return l.classList.add("wrapper"),o.length>0&&(i.prepend(a),i.append(l)),i}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==S(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===S(o)?o:String(o)),r)}var o}var j=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._objectBtn=document.querySelector(".object-btn"),this._folderBtn=document.querySelector(".folder-btn"),this._fileBtn=document.querySelector(".file-btn"),this._generateId=n,this._targetItem,this._addFile=this._addFile.bind(this),this._addFolder=this._addFolder.bind(this),this._addObject=this._addObject.bind(this),this._togglePopup=this._togglePopup.bind(this),this._addButton=document.querySelector(r),this._opened=!1}var t,n;return t=e,(n=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_createItem",value:function(e,t){var n=document.createElement("li");n.classList.add("list-item");var r=document.createElement(e);return r.classList.add("item"),r.tabIndex=0,r.id=this._generateId(),r.textContent=t,"file-element"===e?r.classList.add("item-file"):"folder-element"===e?r.classList.add("item-folder"):"object-element"===e&&r.classList.add("item-object"),n.appendChild(r),n}},{key:"_addFile",value:function(){var e=document.querySelector(".content"),t=this._createItem("file-element","New File");e.appendChild(t),this.close()}},{key:"_addNotFileItem",value:function(e){var t=this,n=document.querySelectorAll(".item");try{n.forEach((function(n){if(!t._targetItem)throw new Error("Необходимо выбрать файл или объект для размещения папки");if(n.id===t._targetItem){var r=n.closest(".list-item"),o="folder"===e?t._createItem("folder-element","New Folder"):t._createItem("object-element","New Object");if(r.children.length>1){var i=r.querySelector(".wrapper"),c=r.querySelector(".caret");i.appendChild(o),!i.classList.contains("active")&&i.classList.add("active"),c.classList.add("caret-down")}else{var a=document.createElement("span");a.classList.add("caret"),a.classList.add("caret-down"),a.addEventListener("click",(function(){this.parentElement.querySelector(".wrapper").classList.toggle("active"),this.classList.toggle("caret-down")}));var l=document.createElement("ul");l.classList.add("wrapper"),l.classList.add("active"),l.appendChild(o),r.prepend(a),r.append(l)}}}))}catch(e){console.log(e.message)}this.close()}},{key:"_addFolder",value:function(){this._addNotFileItem("folder")}},{key:"_addObject",value:function(){this._addNotFileItem("object")}},{key:"_togglePopup",value:function(){this._opened?this.close():this.open()}},{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose),this._fileBtn.addEventListener("click",this._addFile),this._folderBtn.addEventListener("click",this._addFolder),this._objectBtn.addEventListener("click",this._addObject),this._opened=!0}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose),this._fileBtn.removeEventListener("click",this._addFile),this._folderBtn.removeEventListener("click",this._addFolder),this._objectBtn.removeEventListener("click",this._addObject),this._opened=!1}},{key:"setEventListeners",value:function(){var e=this;document.addEventListener("mousedown",(function(t){t.target!==e._objectBtn&&t.target!==e._folderBtn&&t.target!==e._fileBtn&&t.target!==e._addButton&&e.close()})),document.addEventListener("click",(function(t){t.target.classList.contains("item")&&(e._targetItem=t.target.id,t.target.focus())})),this._addButton.addEventListener("click",this._togglePopup)}}])&&E(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function L(e,t){if(e){if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==O(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===O(o)?o:String(o)),r)}var o}function N(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function C(e){var t="function"==typeof Map?new Map:void 0;return C=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return R(e,arguments,I(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),B(r,e)},C(e)}function R(e,t,n){return R=x()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&B(o,n.prototype),o},R.apply(null,arguments)}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var q,F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(c,e);var t,n,r,o,i=(t=c,n=x(),function(){var e,r=I(t);if(n){var o=I(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return N(this,e)});function c(){return k(this,c),i.apply(this,arguments)}return r=c,(o=[{key:"connectedCallback",value:function(){var e=document.querySelector("#treeview"),t=document.importNode(e.content,!0);this.appendChild(t)}}])&&T(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),c}(C(HTMLElement));customElements.define("treeview-webcomp",F);var A,M=document.querySelector(".delete-btn"),D=document.querySelector(".save-btn"),H=document.querySelector(".content"),J=document.querySelector(".search");function U(e,t){(function(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()})(e.children).forEach((function(e){e.childNodes.forEach((function(e){if(e.className.includes("item")){var n={};n.label=e.innerText,n.icon_id=e.id,"file-element"===e.localName?n.type="file":"folder-element"===e.localName?n.type="folder":"object-element"===e.localName&&(n.type="object"),n.children=[],t.push(n),e.nextSibling&&e.nextSibling.className.includes("wrapper")&&U(e.nextSibling,n.children)}}))}))}function $(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function z(e,t,n){e.forEach((function(e){if(e.id===t[n].id){e.focus();var r=e.closest(".list-item").parentNode;r.classList.contains("wrapper")&&!r.classList.contains("active")&&(r.classList.add("active"),e.focus(),e.previousSibling&&e.previousSibling.classList.contains("caret")&&e.previousSibling.classList.add("caret-down"),e.parentNode.parentNode.parentNode.children[0].classList.contains("caret")&&!e.parentNode.parentNode.parentNode.children[0].classList.contains("caret-down")&&e.parentNode.parentNode.parentNode.children[0].classList.add("caret-down"))}}))}new _((A=localStorage.getItem("initialArray"))?JSON.parse(A):[],$).renderTree(),new j(".add-item-popup",$,".add-btn").setEventListeners(),document.addEventListener("click",(function(e){e.target.classList.contains("item")&&(q=e.target.id,e.target.focus())})),M.addEventListener("click",(function(){document.querySelectorAll(".item").forEach((function(e){e.id===q&&e.closest(".list-item").remove()}))})),D.addEventListener("click",(function(){var e=[];U(H,e),localStorage.setItem("initialArray",JSON.stringify(e))})),J.addEventListener("search",(function(){var e=document.querySelectorAll(".item"),t=Array.prototype.slice.call(e).filter((function(e){return e.textContent.toLowerCase().includes(J.value.toLowerCase())})),n=0;z(e,t,n),document.addEventListener("keydown",(function(r){"Enter"===r.key&&n<t.length-1&&z(e,t,n+=1)}))})),function(e,t,n){var r,o=document.querySelector(".content"),i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=L(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){a=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw i}}}}(o.querySelectorAll(".list-item"));try{var c=function(){var e=r.value;e.childNodes.forEach((function(t){t.classList.contains("item-file")&&(e.draggable=!0)}))};for(i.s();!(r=i.n()).done;)c()}catch(e){i.e(e)}finally{i.f()}o.addEventListener("dragstart",(function(e){e.target.classList.add("selected")})),o.addEventListener("dragend",(function(e){e.target.classList.remove("selected")})),o.addEventListener("dragover",(function(e){e.preventDefault();var t=o.querySelector(".selected"),n=e.target;if(t!==n&&n.classList.contains("list-item")){var r=n===t.nextElementSibling?n.nextElementSibling:n;o.insertBefore(t,r)}}))}()})();